{
  "version": 3,
  "sources": ["../../rete-context-menu-plugin/src/presets/classic/factory.ts", "../../rete-context-menu-plugin/src/presets/classic/index.ts", "../../rete-context-menu-plugin/src/presets/index.ts", "../../rete-context-menu-plugin/src/index.ts"],
  "sourcesContent": ["import { NodeEditor } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { Item } from '../../types'\nimport { BSchemes, ItemDefinition } from './types'\n\nexport function createItem<S extends BSchemes>(\n  [label, factory]: ItemDefinition<S>,\n  key: string | number,\n  context: { editor: NodeEditor<S>, area: BaseAreaPlugin<S, any> }\n): Item {\n  const item: Item = {\n    label,\n    key: String(key),\n    handler() {\n      /* noop */\n    }\n  }\n\n  if (typeof factory === 'function') {\n    return {\n      ...item,\n      async handler() {\n        const node = await factory()\n\n        await context.editor.addNode(node)\n\n        void context.area.translate(node.id, context.area.area.pointer)\n      }\n    } satisfies Item\n  }\n  return {\n    ...item,\n    handler() { /* do nothing */ },\n    subitems: factory.map((data, i) => createItem(data, i, context))\n  } satisfies Item\n}\n", "import { NodeEditor } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { Item, Items } from '../../types'\nimport { createItem } from './factory'\nimport { BSchemes, ItemDefinition } from './types'\n\n/**\n * Classic context menu preset.\n * Configures nodes/actions items for root and Delete/Clone items for nodes\n * @param nodes List of items\n * @example Presets.classic.setup([\n *  [\"Math\", [\n *    [\"Number\", () => new NumberNode()],\n *  ]]\n *])\n */\nexport function setup<Schemes extends BSchemes>(nodes: ItemDefinition<Schemes>[]) {\n  return function (context, plugin) {\n    const area = plugin.parentScope<BaseAreaPlugin<Schemes, any>>(BaseAreaPlugin)\n    const editor = area.parentScope<NodeEditor<Schemes>>(NodeEditor)\n\n    if (context === 'root') {\n      return {\n        searchBar: true,\n        list: nodes.map((item, i) => createItem(item, i, { editor, area }))\n      }\n    }\n\n    const deleteItem: Item = {\n      label: 'Delete',\n      key: 'delete',\n      async handler() {\n        if ('source' in context && 'target' in context) {\n          // connection\n          const connectionId = context.id\n\n          await editor.removeConnection(connectionId)\n        } else {\n          // node\n          const nodeId = context.id\n          const connections = editor.getConnections().filter(c => {\n            return c.source === nodeId || c.target === nodeId\n          })\n\n          for (const connection of connections) {\n            await editor.removeConnection(connection.id)\n          }\n          await editor.removeNode(nodeId)\n        }\n      }\n    }\n\n    const clone = context.clone?.bind(context)\n    const cloneItem: undefined | Item = clone && {\n      label: 'Clone',\n      key: 'clone',\n      async handler() {\n        const node = clone()\n\n        await editor.addNode(node)\n\n        void area.translate(node.id, area.area.pointer)\n      }\n    }\n\n    return {\n      searchBar: false,\n      list: [\n        deleteItem,\n        ...cloneItem\n          ? [cloneItem]\n          : []\n      ]\n    }\n  } satisfies Items<Schemes>\n}\n", "/**\n * Presets that create items for root and node specific context menu.\n * @module\n */\n\nexport * as classic from './classic'\n", "import { BaseSchemes, Scope } from 'rete'\nimport { BaseArea, BaseAreaPlugin, RenderSignal } from 'rete-area-plugin'\n\nimport { Item, Items, Position } from './types'\n\nexport * as Presets from './presets'\n\n/**\n * Context menu plugin props\n * @priority 8\n */\nexport type Props<Schemes extends BaseSchemes> = {\n  /**\n   * delay before hiding context menu\n   * @deprecated Use the `delay` option of the rendering plugin preset.\n   */\n  delay?: number\n  /** menu items, can be produced by preset */\n  items: Items<Schemes>\n}\nexport type RenderMeta = { filled?: boolean }\n\n/**\n * Signal types produced by ContextMenuPlugin instance\n * @priority 10\n */\nexport type ContextMenuExtra =\n  | RenderSignal<'contextmenu', {\n    items: Item[]\n    onHide(): void\n    searchBar?: boolean\n  }>\n\ntype Requires<Schemes extends BaseSchemes> =\n  | { type: 'contextmenu', data: { event: MouseEvent, context: 'root' | Schemes['Node'] | Schemes['Connection'] } }\n  | { type: 'unmount', data: { element: HTMLElement } }\n  | { type: 'pointerdown', data: { position: Position, event: PointerEvent } }\n\n/**\n * Plugin for context menu.\n * Responsible for initialing rendering of context menu with predefined items.\n * @priority 9\n * @emits render\n * @emits unmount\n * @listens unmount\n * @listens contextmenu\n * @listens pointerdown\n */\nexport class ContextMenuPlugin<Schemes extends BaseSchemes> extends Scope<never, [Requires<Schemes> | ContextMenuExtra]> {\n  /**\n   * @param props Properties\n   */\n  constructor(private props: Props<Schemes>) {\n    super('context-menu')\n  }\n\n  setParent(scope: Scope<Requires<Schemes>>): void {\n    super.setParent(scope)\n\n    const area = this.parentScope<BaseAreaPlugin<Schemes, BaseArea<Schemes>>>(BaseAreaPlugin)\n    const container: HTMLElement = (area as any).container\n\n    if (!container || !(container instanceof HTMLElement)) throw new Error('container expected')\n\n    const element = document.createElement('div')\n\n    element.style.display = 'none'\n    element.style.position = 'fixed'\n\n    // eslint-disable-next-line max-statements\n    this.addPipe(context => {\n      const parent = this.parentScope()\n\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\n      if (context.type === 'unmount') {\n        if (context.data.element === element) {\n          element.style.display = 'none'\n        }\n      } else if (context.type === 'contextmenu') {\n        context.data.event.preventDefault()\n        context.data.event.stopPropagation()\n\n        const { searchBar, list } = this.props.items(context.data.context, this)\n\n        container.appendChild(element)\n        element.style.left = `${context.data.event.clientX}px`\n        element.style.top = `${context.data.event.clientY}px`\n        element.style.display = ''\n\n        void parent.emit({\n          type: 'render',\n          data: {\n            type: 'contextmenu',\n            element,\n            searchBar,\n            onHide() {\n              void parent.emit({ type: 'unmount', data: { element } })\n            },\n            items: list\n          }\n        })\n      } else if (context.type === 'pointerdown') {\n        if (!context.data.event.composedPath().includes(element)) {\n          void parent.emit({ type: 'unmount', data: { element } })\n        }\n      }\n      return context\n    })\n  }\n}\n"],
  "mappings": "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",
  "names": ["createItem", "_ref", "key", "context", "_ref2", "_slicedToArray", "label", "factory", "item", "String", "handler", "_objectSpread", "_asyncToGenerator", "_regeneratorRuntime", "mark", "_callee", "node", "wrap", "_callee$", "_context", "prev", "next", "sent", "editor", "addNode", "area", "translate", "id", "pointer", "stop", "subitems", "map", "data", "i", "setup", "nodes", "plugin", "_context$clone", "parentScope", "BaseAreaPlugin", "NodeEditor", "searchBar", "list", "deleteItem", "connectionId", "nodeId", "connections", "_iterator", "_step", "connection", "removeConnection", "getConnections", "filter", "c", "source", "target", "_createForOfIteratorHelper", "s", "n", "done", "value", "t0", "e", "f", "finish", "removeNode", "clone", "bind", "cloneItem", "_callee2", "_callee2$", "_context2", "concat", "_toConsumableArray", "ContextMenuPlugin", "_Scope", "props", "_this", "_classCallCheck", "_callSuper", "_inherits", "_createClass", "setParent", "scope", "_this2", "_superPropGet", "container", "HTMLElement", "Error", "element", "document", "createElement", "style", "display", "position", "addPipe", "parent", "_typeof", "type", "event", "preventDefault", "stopPropagation", "_this2$props$items", "items", "appendChild", "left", "clientX", "top", "clientY", "emit", "onHide", "composedPath", "includes", "Scope"]
}
