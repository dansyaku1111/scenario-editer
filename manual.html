<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シナリオエディタ 操作マニュアル</title>
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #2c3e50;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        h1 {
            font-size: 2.5em;
        }
        h2 {
            font-size: 2em;
            margin-top: 40px;
            padding-top: 20px; /* Add padding for anchor links */
        }
        h3 {
            font-size: 1.5em;
            margin-top: 30px;
            border-bottom: 1px solid #e0e0e0;
        }
        code, pre {
            background-color: #ecf0f1;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
        }
        pre {
            padding: 15px;
            overflow-x: auto;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        strong {
            color: #2980b9;
        }
        #toc {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }
        #toc h3 {
            margin-top: 0;
            font-size: 1.2em;
            border-bottom: 1px solid #ccc;
        }
        #toc ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #toc ul li a {
            text-decoration: none;
            color: #3498db;
            font-size: 0.95em;
        }
        #toc ul li a:hover {
            text-decoration: underline;
        }
        @media (max-width: 1100px) {
            #toc {
                display: none;
            }
        }
    </style>
</head>
<body>

    <nav id="toc">
        <h3>目次</h3>
        <ul>
            <li><a href="#summary">概要</a></li>
            <li><a href="#layout">画面構成</a></li>
            <li><a href="#json-details">JSON詳細</a></li>
            <li><a href="#editor-operations">エディタの基本操作</a></li>
            <li><a href="#node-types">各ノードの説明</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1>シナリオエディタ 操作マニュアル</h1>

        <h2 id="summary">概要</h2>
        <p>このアプリケーションは、<a href="https://retejs.org/" target="_blank">Rete.js</a>フレームワークをベースに構築された、ノードベースのUIを使用してシナリオフローを作成、編集、視覚化するためのツールです。作成したシナリオはJSON形式でエクスポートおよびインポートできます。</p>

        <h2 id="layout">画面構成</h2>
        <ol>
            <li><strong>ツールバー</strong>: 画面上部にあり、ノードの追加やファイルの操作を行うためのボタンが配置されています。</li>
            <li><strong>ノードエディタ</strong>: 中央の広い領域で、ここにノードを配置し、線でつないでシナリオのフローを構築します。</li>
            <li><strong>JSON出力</strong>: 画面下部にあり、作成したシナリオの構造がJSON形式で表示されます。<code>JSONエクスポート</code>ボタンを押すと更新されます。</li>
        </ol>

        <h2 id="json-details">JSONインポート・エクスポートの詳細</h2>
        <p>このエディタで作成されたシナリオは、特定の構造を持つJSONファイルとして保存・読込されます。</p>
        <h3>エクスポート</h3>
        <p>ツールバーの<code>JSONエクスポート</code>ボタンをクリックすると、現在のシナリオの状態がJSONファイルとして自動的にダウンロードされます。ファイル名は <code>scenario_{タイムスタンプ}.json</code> となります。</p>
        <h3>インポート</h3>
        <p>ツールバーの<code>JSONインポート</code>ボタンをクリックし、以前にエクスポートしたJSONファイルを選択すると、キャンバスの状態が復元されます。</p>
        <h3>JSONの形式・仕様</h3>
        <p>JSONファイルは主に <code>nodes</code> と <code>connections</code> という2つの主要な配列を持っています。</p>
        <ul>
            <li><code>nodes</code>: キャンバス上の各ノードの情報が含まれます。
                <ul>
                    <li><code>id</code>: ノードの一意なID。</li>
                    <li><code>label</code>: ノードのヘッダーに表示される名前（例: 'Start', 'Action'）。</li>
                    <li><code>type</code>: ノードの種類（'start', 'action', 'condition', 'end'）。</li>
                    <li><code>data</code>: ノード固有のデータ。主に編集可能なテキストが格納されます。</li>
                    <li><code>x</code>, <code>y</code>: キャンバス上のノードの座標。</li>
                </ul>
            </li>
            <li><code>connections</code>: ノード間の接続情報が含まれます。
                <ul>
                    <li><code>id</code>: 接続の一意なID。</li>
                    <li><code>source</code>: 接続元のノードID。</li>
                    <li><code>sourceOutput</code>: 接続元の出力ソケット名。</li>
                    <li><code>target</code>: 接続先のノードID。</li>
                    <li><code>targetInput</code>: 接続先の入力ソケット名。</li>
                </ul>
            </li>
        </ul>
        <h4>サンプルJSON</h4>
        <pre><code>{
  "nodes": [
    {
      "id": "[ID]",
      "label": "Start",
      "type": "start",
      "data": {
        "text": ""
      },
      "x": 100,
      "y": 100
    },
    {
      "id": "[ID]",
      "label": "Action",
      "type": "action",
      "data": {
        "text": "何かを実行する"
      },
      "x": 400,
      "y": 100
    }
  ],
  "connections": [
    {
      "id": "[ID]",
      "source": "[StartノードのID]",
      "sourceOutput": "exec",
      "target": "[ActionノードのID]",
      "targetInput": "exec"
    }
  ]
}</code></pre>

        <h2 id="editor-operations">エディタの基本操作 (Rete.js)</h2>
        <p>このエディタはRete.jsライブラリ群によって多くの機能が提供されています。</p>
        <ul>
            <li><strong>視点の移動 (パン)</strong>: キャンバスの何もない領域をドラッグすると、表示領域を上下左右に移動できます。</li>
            <li><strong>拡大・縮小 (ズーム)</strong>: マウスホイールをスクロールすることで、キャンバスの中心を基準に拡大・縮小ができます。</li>
            <li><strong>ノードの追加</strong>:
                <ul>
                    <li>ツールバーの「〇〇ノード追加」ボタンをクリックします。</li>
                    <li>または、エディタ領域で右クリックして表示されるコンテキストメニューから追加したいノードを選択します。</li>
                </ul>
            </li>
            <li><strong>ノード/接続の選択</strong>: ノードまたは接続線をクリックすると選択状態になります。</li>
            <li><strong>複数選択</strong>:
                <ul>
                    <li><code>Ctrl</code>キーを押しながらクリックすると、複数のノードや接続を追加選択できます。</li>
                    <li>キャンバスの何もない領域からドラッグを開始すると、矩形選択範囲が表示され、範囲内のすべての要素を選択できます。</li>
                </ul>
            </li>
            <li><strong>ノードの移動</strong>: 選択したノードをドラッグ＆ドロップすることで、任意の位置に移動できます。</li>
            <li><strong>ノードの接続</strong>: あるノードの出力ソケット（右側の円）から別のノードの入力ソケット（左側の円）へドラッグすると、接続線を作成できます。</li>
            <li><strong>ノード/接続の削除</strong>: 選択したノードまたは接続を<code>Delete</code>キーで削除できます。</li>
            <li><strong>テキストの編集</strong>: 「アクションノード」や「条件分岐ノード」内のテキスト部分をクリックすると、内容を編集できます。</li>
        </ul>

        <h2 id="node-types">各ノードの説明</h2>
        <h3>スタートノード</h3>
        <p>シナリオの開始点を示します。</p>
        <ul>
            <li>入力ソケット: 0個</li>
            <li>出力ソケット: 1個</li>
        </ul>

        <h3>アクションノード</h3>
        <p>特定の処理や動作を表します。</p>
        <ul>
            <li>入力ソケット: 1個</li>
            <li>出力ソケット: 1個</li>
        </ul>

        <h3>条件分岐ノード</h3>
        <p>特定の条件に基づいてフローを分岐させます。</p>
        <ul>
            <li>入力ソケット: 1個</li>
            <li>出力ソケット: 2個（True と False）</li>
        </ul>

        <h3>エンドノード</h3>
        <p>シナリオの終了点を示します。</p>
        <ul>
            <li>入力ソケット: 1個</li>
            <li>出力ソケット: 0個</li>
        </ul>
    </div>
</body>
</html>
